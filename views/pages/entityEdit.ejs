<% include ../partials/header %>
<div id="row-container">
    <div id="main-window">
        <div>
            <a href="/entities/<%-entityData.id %>">Voir la fiche</a>
            <br>
            <img class="entity-default-icon" src="<%-entityData.defaultimage %>" />
            <h1><%-entityData.label %></h1>
            <% if (entityData.profile_pic_url) { %>
            <div class="entity-profile-img-container">
                <img class="entity-profile-img" src="<%-entityData.profile_pic_url %>" />
            </div>
            <% } %>
            <form action="/entities/update/<%-entityData.id %>" method="post">
                <label for="name">Nom</label>
                <input type="text" name="name" value="<%-entityData.label %>"/>
                <br>
                <label for="entityTypeId">Type</label>
                <select name="entityTypeId">
                        <% for (var j=0; j<entityTypes.length; j++) { %>
                            <option value="<%-entityTypes[j].id %>" <% if (entityTypes[j].id==entityData.entity_type_id) { %> selected <% } %>><%-entityTypes[j].name %></option>
                        <% } %>
                </select>
                <br>
                <label for="profilePicUrl">Image</label>
                <input type="text" name="profilePicUrl" value="<%-entityData.profile_pic_url %>"/>
                <br><input type="submit" value="Enregistrer" />
            </form>
        </div>
        <br class="clear-both" />
        <h2>Créer une relation</h2>
        <form action="/relations/insert" method="post">
            <input type="hidden" name="entitySourceId" value="<%-currentItemId %>" />
            <div class="search-container">
                <div class="search-element">
                    <label>Avec</label><input id="searchEntityAutoComplete" type="text" />
                    <div id="search-entity-results" class="search-results"></div>
                </div>
            </div>
            <br class="clear-both"><input type="hidden" name="entityDestinationId" id="entity-destination-id">
            <div id="entity-destination-name"></div>
            <br><label>Année de début</label> <input type="text" name="year_begin" type="number"/>
            <label>Année de fin</label> <input type="text" name="year_end" type="number"/>
            <br><label>Libellé</label> <input type="text" name="name" type="text"/>
            <br><input type="submit" value="Créer" />
        </form>
        <br class="clear-both" />
        <h2>En relation avec</h2>
        <table>
            <tr><td></td><td>Nom</td><td>Relation</td><td>Débute en</td><td>Se termine en</td><td></td><td></td></tr>
            <% for (var i=0; i<relationsItems.length; i++) { %>
                <tr>
                    <td><% if (relationsItems[i].profile_pic_url) { %>
                            <img class="entity-profile-img-small" src="<%-relationsItems[i].profile_pic_url %>" />
                        <% } %></td>
                    <td><b><a href="/entities/edit/<%-relationsItems[i].entity_id %>"><%-relationsItems[i].entity_name %></a></b></td>
                    <td><%-relationsItems[i].relation_name %></td>
                    <td><%-relationsItems[i].relation_year_begin %></td>
                    <td><%-relationsItems[i].relation_year_end %></td>
                    <td><a href="/relations/edit/<%-relationsItems[i].relation_id %>?returnId=<%-entityData.id %>">Editer</a></td>
                    <td><form action="/relations/delete/<%-relationsItems[i].relation_id %>" method="post"><input type="hidden" name="returnEntityId" value="<%-entityData.id %>" /><input type="submit" value="Supprimer"></form></td>
                </tr>
            <% } %>
        </table>
    </div>
</div>
<script type="text/javascript">
    listenSearchAutocompleteQueries("searchEntityAutoComplete","search-entity-results","createInput");
</script>
<% include ../partials/footer %>
